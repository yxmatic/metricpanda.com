<!DOCTYPE html><html class=no-js><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Cross compiling for Three Platforms | Metric Panda Games</title><meta name=description content="I’ve moved permanently to Linux as my development platform. I’m in love! Linux is giving me even more freedom from clutter and OS annoyances than what OSX was giving me. How did..."><meta name=keywords><meta property=og:title content="Cross compiling for Three Platforms | Metric Panda Games"><meta property=og:type content=website><meta property=og:locale content=en_US><meta property=og:url content="https://metricpanda.com/rival-fortress-update-11-cross-compiling-for-three-platforms/"><meta property=og:image content=https://metricpanda.commetric-panda-1024x1024.png><meta name=twitter:title content="Cross compiling for Three Platforms"><meta name=twitter:card content=summary_large_image><meta name=twitter:site content=@MetricPandaGame><meta name=twitter:creator content=@Unspongeful><meta name=twitter:description content="I’ve moved permanently to Linux as my development platform. I’m in love! Linux is giving me even more freedom from clutter and OS annoyances than what OSX was giving me. How did..."><meta name=twitter:url content="https://metricpanda.com/rival-fortress-update-11-cross-compiling-for-three-platforms/"><meta name=twitter:url content="https://metricpanda.com/rival-fortress-update-11-cross-compiling-for-three-platforms/"><meta name=twitter:image content=https://metricpanda.commetric-panda-1024x1024.png><meta name=twitter:image:alt content="Cross compiling for Three Platforms"><link rel=canonical href="https://metricpanda.com/rival-fortress-update-11-cross-compiling-for-three-platforms/"><link rel=alternate type=application/rss+xml title="Metric Panda Games" href=https://metricpanda.com/feed.xml><link rel=apple-touch-icon href=apple-icon-precomposed.png><link rel="shortcut icon" sizes="16x16 24x24 32x32 48x48 64x64" href=https://metricpanda.com/favicon.ico><link data-turbolinks-track=reload rel=stylesheet type=text/css href=/assets/metricpanda-39b1a813586a62f5ab272a1dc423ec22fa36f235ccc08b5ec4a21a2c11cc3fe9.css></head><body><header class="header clearfix"><nav class="navbar navbar-custom js-navbar navbar-fixed-top"><div class=container><h3 class=text-muted><a href="/" class=title-backlink><span class=logo-icon><i class="logo-state sprite sprite-small-logo"></i></span><span class=logo-name>MPG</span></a></h3><ul class=nav><li class="nav-link-important nav-link"><a class=nav-action href=/rival-fortress>rival fortress</a></li><li class=nav-separator><i class="icon icon-circle"></i></li><li class=nav-link><a class=nav-action href="/">news</a></li><li class=nav-link><a class=nav-action href=/press.html>press</a></li><li class=nav-link><a data-turbolinks=false class="nav-action js-search-button search-button" href="/">&nbsp;<i class="icon icon-search"></i></a></li></ul></div></nav><section class="masthead js-masthead"><div class=masthead-home><div class=metric-panda-logo><a href="/" class="sprite sprite-logo"></a></div><h1>Metric Panda Games</h1><h2>One pixel at a time.<i></i></h2></div><div class="home-nav clearfix"><ul class="nav nav-pills"><li class=nav-item><span class="nav-block nav-title">News:</span></li><li class=nav-item><a class="nav-block nav-link" href="/">Featured</a></li><li class=nav-item><a class="nav-block nav-link" href="/news/">All</a></li><li class=nav-item><a class="nav-block nav-link" href=/news/rival-fortress.html>Rival Fortress</a></li><li class=nav-item><a class="nav-block nav-link" href=/news/other.html>Other</a></li></ul></div><div><div class="js-masthead-rainbow masthead-rainbow"><i></i></div></div></section></header><section class="js-search-results search-results"><div class="container page-content"><form class="js-search-form search-form"><div class=input-group><input type=text class="form-control js-search-query" placeholder=Search...> <span class=input-group-btn><button class="btn btn-primary" type=submit>Search</button></span></div></form><div class="js-search-results-list search-results-list posts post-list"></div><div class="js-search-results-listing js-search-result-status search-result-status search-result-listing"><button type=button class="btn btn-success js-close-search">Close <i class="icon icon-cancel-1"></i></button></div><div class="js-search-results-loading js-search-result-status search-result-status search-result-loading"><button type=button class="btn btn-info js-close-search">Loading...</button></div><div class="js-search-results-empty js-search-result-status search-result-status search-result-empty"><button type=button class="btn btn-danger js-close-search">No results found <i class="icon icon-cancel-1"></i></button></div></div></section><section class="js-main-content main-content"><article class="page-width post-page container page-content"><header class=post-header><h1 class=post-title>Cross compiling for Three Platforms</h1><p class=game-update><a href=rival-fortress>Rival Fortress Update #11</a></p><p class=post-meta>by <em>Gianni Milanesi</em> <span class=dot>•</span> Category: <a href=/news/rival-fortress.html>Rival Fortress</a></p></header><div class=post-content><p>I’ve moved permanently to Linux as my development platform. I’m in love! Linux is giving me even more freedom from clutter and OS annoyances than <a href=/rival-fortress-update-5-cross-platform-development/index.html>what OSX was giving me</a>. How did I ever get by without a <a href="https://i3wm.org/">tiling window manager</a>!</p><p><em>Fanboyism</em> aside, this week I finally finished the cross compiling setup that <a href=/rival-fortress-update-5-cross-platform-development/index.html>I started working on a while back</a>.</p><p>Whenever I push commits to the <a href=https://github.com>Github</a> repository, an automated build triggers for the three platforms that <a href=/rival-fortress/index.html>Rival Fortress</a> will ship on: Windows (32/64bits), Linux (32/64bits) and OSX(64bits).</p><p>The build “server” is Mac Mini running a bare bones installation of <a href=https://www.archlinux.org>Arch Linux</a>.</p><h2 id=cross-compilation-process>Cross compilation process</h2><p>The cross compilation process is handled by a simple bash script. The setup step, that is run only once after a clean <code class=highlighter-rouge>git clone</code>, initializes <a href=https://cmake.org>Cmake</a> for the 5 “platforms” like so:</p><figure class=highlight><pre><code class=language-bash data-lang=bash><span class=c># 64 bit builds</span>
<span class=k>if</span> <span class=o>[</span> <span class=o>!</span> <span class=nt>-d</span> build/linux64 <span class=o>]</span><span class=p>;</span> <span class=k>then
  </span>cmake <span class=nt>-H</span><span class=nb>.</span> <span class=nt>-Bbuild</span>/linux64 <span class=nt>-G</span> Ninja <span class=nt>-DCMAKE_BUILD_TYPE</span><span class=o>=</span>Debug
<span class=k>fi

if</span> <span class=o>[</span> <span class=o>!</span> <span class=nt>-d</span> build/osx <span class=o>]</span><span class=p>;</span> <span class=k>then
  </span>cmake <span class=nt>-H</span><span class=nb>.</span> <span class=nt>-Bbuild</span>/osx <span class=nt>-G</span> Ninja <span class=nt>-DCMAKE_BUILD_TYPE</span><span class=o>=</span>Debug <span class=nt>-DCMAKE_TOOLCHAIN_FILE</span><span class=o>=</span>cmake/x86_64-osx.cmake
<span class=k>fi

if</span> <span class=o>[</span> <span class=o>!</span> <span class=nt>-d</span> build/win64 <span class=o>]</span><span class=p>;</span> <span class=k>then
  </span>cmake <span class=nt>-H</span><span class=nb>.</span> <span class=nt>-Bbuild</span>/win64 <span class=nt>-G</span> Ninja <span class=nt>-DCMAKE_BUILD_TYPE</span><span class=o>=</span>Debug <span class=nt>-DCMAKE_TOOLCHAIN_FILE</span><span class=o>=</span>cmake/x86_64-w64-mingw32.cmake
<span class=k>fi</span>


<span class=c># 32 bit builds</span>
<span class=k>if</span> <span class=o>[</span> <span class=o>!</span> <span class=nt>-d</span> build/linux32 <span class=o>]</span><span class=p>;</span> <span class=k>then
  </span><span class=nv>CFLAGS</span><span class=o>=</span><span class=nt>-m32</span> <span class=nv>CXXFLAGS</span><span class=o>=</span><span class=nt>-m32</span> cmake <span class=nt>-H</span><span class=nb>.</span> <span class=nt>-Bbuild</span>/linux32 <span class=nt>-G</span> Ninja <span class=nt>-DCMAKE_BUILD_TYPE</span><span class=o>=</span>Debug <span class=nt>-DCMAKE_TOOLCHAIN_FILE</span><span class=o>=</span>cmake/i686-linux.cmake
<span class=k>fi

if</span> <span class=o>[</span> <span class=o>!</span> <span class=nt>-d</span> build/win32 <span class=o>]</span><span class=p>;</span> <span class=k>then
  </span>cmake <span class=nt>-H</span><span class=nb>.</span> <span class=nt>-Bbuild</span>/win32 <span class=nt>-G</span> Ninja <span class=nt>-DCMAKE_BUILD_TYPE</span><span class=o>=</span>Debug <span class=nt>-DCMAKE_TOOLCHAIN_FILE</span><span class=o>=</span>cmake/i686-w64-mingw32.cmake
<span class=k>fi</span></code></pre></figure><p>Each build, a part from the 64 bit Linux, has a toolchain file associated with it that specifies the compiler to use and the path to libraries and headers.</p><p>The 64 bit Linux build doesn’t need a toolchain file since the system is 64 bit and is configured to build by default using Clang 3.8.</p><p>The 64 bit Linux also runs first as it is the only build that will run the <a href=/rival-fortress-update-7-reflection-preprocessor-in-c-cpp/index.html>reflection preprocessor</a> and other build time custom tools that generate code.</p><h2 id=toolchains>Toolchains</h2><p>I’m using <a href="http://mingw-w64.org/">mingw-w64</a> to build Windows binaries and <a href=https://github.com/tpoechtrager/osxcross>OSX Cross</a> to build for OSX.</p><p>This is the toolchain file I use to compile Windows 64bit binaries:</p><figure class=highlight><pre><code class=language-cmake data-lang=cmake><span class=nb>set</span><span class=p>(</span>CMAKE_SYSTEM_NAME Windows<span class=p>)</span>
<span class=nb>set</span><span class=p>(</span>CMAKE_SYSTEM_VERSION 1<span class=p>)</span>
<span class=nb>set</span><span class=p>(</span>CMAKE_SYSTEM_PROCESSOR x86_64<span class=p>)</span>
<span class=nb>set</span><span class=p>(</span>TOOLCHAIN_PREFIX x86_64-w64-mingw32<span class=p>)</span>

<span class=nb>set</span><span class=p>(</span>CMAKE_C_COMPILER     <span class=s2>"</span><span class=si>${</span><span class=nv>TOOLCHAIN_PREFIX</span><span class=si>}</span><span class=s2>-gcc"</span><span class=p>)</span>
<span class=nb>set</span><span class=p>(</span>CMAKE_CXX_COMPILER   <span class=s2>"</span><span class=si>${</span><span class=nv>TOOLCHAIN_PREFIX</span><span class=si>}</span><span class=s2>-g++"</span><span class=p>)</span>

<span class=nb>set</span><span class=p>(</span>CMAKE_FIND_ROOT_PATH_MODE_PROGRAM NEVER<span class=p>)</span>
<span class=nb>set</span><span class=p>(</span>CMAKE_FIND_ROOT_PATH_MODE_LIBRARY ONLY<span class=p>)</span>
<span class=nb>set</span><span class=p>(</span>CMAKE_FIND_ROOT_PATH_MODE_INCLUDE ONLY<span class=p>)</span>
<span class=nb>set</span><span class=p>(</span>CMAKE_CROSS_COMPILING TRUE<span class=p>)</span></code></pre></figure><p>Other toolchain files are similar, the only change is <code class=highlighter-rouge>x86_64</code> to <code class=highlighter-rouge>i686</code> and the <code class=highlighter-rouge>TOOLCHAIN_PREFIX</code>. You can read more about <a href=https://cmake.org/Wiki/CMake_Cross_Compiling>cross-compiling with Cmake</a> on the docs.</p><p>The variable <code class=highlighter-rouge>CMAKE_CROSS_COMPILING</code> is used throughout the <code class=highlighter-rouge>CMakeLists.txt</code> files to disable running of preprocessing tools I mentioned earlier.</p><h2 id=building>Building</h2><p>The actual build process is rather simple: the same bash script I mentioned above serially runs <a href=https://ninja-build.org>Ninja</a> on each folder like so:</p><figure class=highlight><pre><code class=language-cmake data-lang=cmake>  ninja -C build/&lt;platform&gt;</code></pre></figure><p>If the build fails the <code class=highlighter-rouge>stderr</code> is redirected to a <code class=highlighter-rouge>BUILD_ERRORS.txt</code> file that I can later review. Whenever a build breaks for a platform I run the same toolchain on my main development workstation and fix the bugs.</p><p>I’m currently building only in debug mode, but when I’ll integrate automated testing for I’ll enable Release mode to. Cross-platform automated testing will be tricky as I’ll probably have to use some form of <a href=https://en.wikipedia.org/wiki/Operating-system-level_virtualization>OS virtualization</a>.</p><p>Obviously a successful build doesn’t mean the actual game will run on the target platform, but that will be (hopefully) handled when I implement automated testing.</p><aside class="share readable"><span>Share this:</span> <a href="http://twitter.com/share?text=Rival Fortress Update #11: Cross compiling for Three Platforms&amp;url=https://metricpanda.com/rival-fortress-update-11-cross-compiling-for-three-platforms/index.html" class=js-analytics data-target=twitter-share onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;"><i class="icon icon-twitter"></i></a> <a href="https://www.facebook.com/sharer/sharer.php?u=https://metricpanda.com/rival-fortress-update-11-cross-compiling-for-three-platforms/index.html" class=js-analytics data-target=facebook-share onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;"><i class="icon icon-facebook"></i></a></aside></div><hr class=hr><div class="page-width newsletter-form"><form action=https://tinyletter.com/metricpanda class=js-analytics-form data-target=newsletter-submit method=post target=popupwindow onsubmit="window.open('https://tinyletter.com/metricpanda', 'popupwindow', 'scrollbars=yes,width=800,height=600');return true"><label for=tlemail><b>Metric Panda Digest</b> <em>(sent monthly and <a data-turbolinks=false class=js-analytics data-target=newsletter-preview href=/newsletters/newsletter-2016-september.html>looks like this</a>)</em></label><div class=input-group><input type=email name=email class=form-control id=tlemail placeholder="Enter your email" required> <input type=hidden value=1 name=embed> <span class=input-group-btn><button class="btn btn-primary" type=submit>Submit</button></span></div><small class=text-muted>We hate spam as much as you do!</small></form></div><hr class=hr></article></section><footer class="site-footer clearfix"><ul class="social js-social"><li><a href=https://github.com/MetricPanda class=js-analytics data-target=github-metricpanda-footer target=_blank><i class="icon icon-github-circled"></i> <b>Github</b></a></li></ul><small>&copy; 2019 Metric Panda Games All rights reserved. <i class="icon icon-star-empty" title=d32745f></i></small><div class=footer-logo><i class="icon icon-metric-panda"></i></div></footer><script data-turbolinks-track=reload data-turbolinks-eval=false type=text/javascript src=/assets/metricpanda-642bfda95fce5f4276f3ac16fa8c8ff98d1d3ef275ab201acce574d9b5d1888f.js></script></body></html>