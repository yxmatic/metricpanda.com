<!DOCTYPE html><html class=no-js><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Tips for Productive Debugging with GDB | Metric Panda Games</title><meta name=description content="In this post I&#39;ll share my favorite tips for getting the most out of debugging with GDB."><meta name=keywords><meta property=og:title content="Tips for Productive Debugging with GDB | Metric Panda Games"><meta property=og:type content=website><meta property=og:locale content=en_US><meta property=og:url content="https://metricpanda.com/tips-for-productive-debugging-with-gdb/"><meta property=og:image content=https://metricpanda.comgdb-dashboard.png><meta name=twitter:title content="Tips for Productive Debugging with GDB"><meta name=twitter:card content=summary_large_image><meta name=twitter:site content=@MetricPandaGame><meta name=twitter:creator content=@Unspongeful><meta name=twitter:description content="In this post I&#39;ll share my favorite tips for getting the most out of debugging with GDB."><meta name=twitter:url content="https://metricpanda.com/tips-for-productive-debugging-with-gdb/"><meta name=twitter:url content="https://metricpanda.com/tips-for-productive-debugging-with-gdb/"><meta name=twitter:image content=https://metricpanda.comgdb-dashboard.png><meta name=twitter:image:alt content="Tips for Productive Debugging with GDB"><link rel=canonical href="https://metricpanda.com/tips-for-productive-debugging-with-gdb/"><link rel=alternate type=application/rss+xml title="Metric Panda Games" href=https://metricpanda.com/feed.xml><link rel=apple-touch-icon href=apple-icon-precomposed.png><link rel="shortcut icon" sizes="16x16 24x24 32x32 48x48 64x64" href=https://metricpanda.com/favicon.ico><link data-turbolinks-track=reload rel=stylesheet type=text/css href=/assets/metricpanda-39b1a813586a62f5ab272a1dc423ec22fa36f235ccc08b5ec4a21a2c11cc3fe9.css></head><body><header class="header clearfix"><nav class="navbar navbar-custom js-navbar navbar-fixed-top"><div class=container><h3 class=text-muted><a href="/" class=title-backlink><span class=logo-icon><i class="logo-state sprite sprite-small-logo"></i></span><span class=logo-name>MPG</span></a></h3><ul class=nav><li class="nav-link-important nav-link"><a class=nav-action href=/rival-fortress>rival fortress</a></li><li class=nav-separator><i class="icon icon-circle"></i></li><li class=nav-link><a class=nav-action href="/">news</a></li><li class=nav-link><a class=nav-action href=/press.html>press</a></li><li class=nav-link><a data-turbolinks=false class="nav-action js-search-button search-button" href="/">&nbsp;<i class="icon icon-search"></i></a></li></ul></div></nav><section class="masthead js-masthead"><div class=masthead-home><div class=metric-panda-logo><a href="/" class="sprite sprite-logo"></a></div><h1>Metric Panda Games</h1><h2>One pixel at a time.<i></i></h2></div><div class="home-nav clearfix"><ul class="nav nav-pills"><li class=nav-item><span class="nav-block nav-title">News:</span></li><li class=nav-item><a class="nav-block nav-link" href="/">Featured</a></li><li class=nav-item><a class="nav-block nav-link" href="/news/">All</a></li><li class=nav-item><a class="nav-block nav-link" href=/news/rival-fortress.html>Rival Fortress</a></li><li class=nav-item><a class="nav-block nav-link" href=/news/other.html>Other</a></li></ul></div><div><div class="js-masthead-rainbow masthead-rainbow"><i></i></div></div></section></header><section class="js-search-results search-results"><div class="container page-content"><form class="js-search-form search-form"><div class=input-group><input type=text class="form-control js-search-query" placeholder=Search...> <span class=input-group-btn><button class="btn btn-primary" type=submit>Search</button></span></div></form><div class="js-search-results-list search-results-list posts post-list"></div><div class="js-search-results-listing js-search-result-status search-result-status search-result-listing"><button type=button class="btn btn-success js-close-search">Close <i class="icon icon-cancel-1"></i></button></div><div class="js-search-results-loading js-search-result-status search-result-status search-result-loading"><button type=button class="btn btn-info js-close-search">Loading...</button></div><div class="js-search-results-empty js-search-result-status search-result-status search-result-empty"><button type=button class="btn btn-danger js-close-search">No results found <i class="icon icon-cancel-1"></i></button></div></div></section><section class="js-main-content main-content"><article class="page-width post-page container page-content"><header class=post-header><h1 class=post-title>Tips for Productive Debugging with GDB</h1><p class=post-meta>by <em>Gianni Milanesi</em> <span class=dot>•</span> Category: <a href=/news/other.html>Other</a></p></header><div class=post-content><p>In this post I’ll share my favorite tips for getting the most out of <a href="https://www.gnu.org/software/gdb/">GDB</a>.</p><h2 id=tip-1-try-gdb-dashboard><strong>Tip #1</strong>: Try GDB Dashboard</h2><p>This may or may not be your cup of tea, but if, like me, you like having access to more program information at every <em>break stop</em> you may want to try <a href=https://github.com/cyrus-and/gdb-dashboard>GDB Dashboard</a>.</p><p>It is a fantastic modular interface that comes as a <code class=highlighter-rouge>.gdbinit</code> replacement and, with <strong>all modules enabled</strong>, looks like this:</p><div class=post-media></div><p>Take a look at the <a href=https://github.com/cyrus-and/gdb-dashboard>Github repository</a> for the project for more information on how to customize it to fit your needs.</p><h2 id=tip-2-use-a-global-gdbinit-and-a-project-gdbinit><strong>Tip #2</strong>: Use a global <code class=highlighter-rouge>.gdbinit</code> and a project <code class=highlighter-rouge>.gdbinit</code></h2><p><code class=highlighter-rouge>.gdbinit</code> is the configuration file that gdb sources at startup. You can have one in your home directory (<code class=highlighter-rouge>~/.gdbinit</code>) for global settings, and one in the current directory (<code class=highlighter-rouge>./.gdbinit</code>) for project specific settings.</p><p>As you will see from the following tips, project specific settings for gdb can be useful for custom formatters or aliases.</p><p>Note: you must enable project specific <code class=highlighter-rouge>.gdbinit</code> files with the <code class=highlighter-rouge>set auto-load local-gdbinit</code>.</p><h2 id=tip-3-use-custom-formatters><strong>Tip #3</strong>: Use custom formatters</h2><p>Custom C/C++ types can be <em>noisy</em> to inspect in the debugger, especially if implemented using <code class=highlighter-rouge>unions</code>.</p><p>With gdb’s <a href=https://sourceware.org/gdb/onlinedocs/gdb/Pretty-Printing.html#Pretty-Printing>Pretty Printing</a> you can define custom formatters for your data types in order to make them more readable.</p><p>For example, in <a href=/rival-fortress/index.html>Rival Fortress</a> I have a matrix data type (<code class=highlighter-rouge>MPEMatrix4</code>) that is a <code class=highlighter-rouge>union</code> of many <a href=https://gcc.gnu.org/onlinedocs/gcc/Unnamed-Fields.html>anonymous structs</a> for developer convenience. This is what it looks like before and after using a custom print formatter:</p><div class=post-media></div><p>And this is the source for the custom formatter:</p><figure class=highlight><pre><code class=language-python data-lang=python><span class=k>class</span> <span class=nc>MPEMatrixPrinter</span><span class=p>:</span>
  <span class=s>"""Print a 4x4 matrix."""</span>

  <span class=k>def</span> <span class=nf>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>val</span><span class=p>,</span> <span class=n>size</span><span class=p>):</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>val</span> <span class=o>=</span> <span class=n>val</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>size</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>size</span><span class=p>)</span>

  <span class=k>def</span> <span class=nf>to_string</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
    <span class=k>return</span> <span class=p>(</span><span class=s>"</span><span class=se>\n\t</span><span class=s>[ </span><span class=si>%3</span><span class=s>g </span><span class=si>%3</span><span class=s>g </span><span class=si>%3</span><span class=s>g </span><span class=si>%3</span><span class=s>g ]"</span>
            <span class=s>"</span><span class=se>\n\t</span><span class=s>[ </span><span class=si>%3</span><span class=s>g </span><span class=si>%3</span><span class=s>g </span><span class=si>%3</span><span class=s>g </span><span class=si>%3</span><span class=s>g ]"</span>
            <span class=s>"</span><span class=se>\n\t</span><span class=s>[ </span><span class=si>%3</span><span class=s>g </span><span class=si>%3</span><span class=s>g </span><span class=si>%3</span><span class=s>g </span><span class=si>%3</span><span class=s>g ]"</span>
            <span class=s>"</span><span class=se>\n\t</span><span class=s>[ </span><span class=si>%3</span><span class=s>g </span><span class=si>%3</span><span class=s>g </span><span class=si>%3</span><span class=s>g </span><span class=si>%3</span><span class=s>g ]"</span><span class=p>)</span> <span class=o>%</span> \
                <span class=p>(</span><span class=nb>float</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>val</span><span class=p>[</span><span class=s>"flat"</span><span class=p>][</span><span class=mi>0</span><span class=p>]),</span> <span class=nb>float</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>val</span><span class=p>[</span><span class=s>"flat"</span><span class=p>][</span><span class=mi>1</span><span class=p>]),</span> <span class=nb>float</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>val</span><span class=p>[</span><span class=s>"flat"</span><span class=p>][</span><span class=mi>2</span><span class=p>]),</span> <span class=nb>float</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>val</span><span class=p>[</span><span class=s>"flat"</span><span class=p>][</span><span class=mi>3</span><span class=p>]),</span>
                <span class=nb>float</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>val</span><span class=p>[</span><span class=s>"flat"</span><span class=p>][</span><span class=mi>4</span><span class=p>]),</span> <span class=nb>float</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>val</span><span class=p>[</span><span class=s>"flat"</span><span class=p>][</span><span class=mi>5</span><span class=p>]),</span> <span class=nb>float</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>val</span><span class=p>[</span><span class=s>"flat"</span><span class=p>][</span><span class=mi>6</span><span class=p>]),</span> <span class=nb>float</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>val</span><span class=p>[</span><span class=s>"flat"</span><span class=p>][</span><span class=mi>7</span><span class=p>]),</span>
                <span class=nb>float</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>val</span><span class=p>[</span><span class=s>"flat"</span><span class=p>][</span><span class=mi>8</span><span class=p>]),</span> <span class=nb>float</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>val</span><span class=p>[</span><span class=s>"flat"</span><span class=p>][</span><span class=mi>9</span><span class=p>]),</span> <span class=nb>float</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>val</span><span class=p>[</span><span class=s>"flat"</span><span class=p>][</span><span class=mi>10</span><span class=p>]),</span> <span class=nb>float</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>val</span><span class=p>[</span><span class=s>"flat"</span><span class=p>][</span><span class=mi>11</span><span class=p>]),</span>
                <span class=nb>float</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>val</span><span class=p>[</span><span class=s>"flat"</span><span class=p>][</span><span class=mi>12</span><span class=p>]),</span> <span class=nb>float</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>val</span><span class=p>[</span><span class=s>"flat"</span><span class=p>][</span><span class=mi>13</span><span class=p>]),</span> <span class=nb>float</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>val</span><span class=p>[</span><span class=s>"flat"</span><span class=p>][</span><span class=mi>14</span><span class=p>]),</span> <span class=nb>float</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>val</span><span class=p>[</span><span class=s>"flat"</span><span class=p>][</span><span class=mi>15</span><span class=p>]))</span>

<span class=k>def</span> <span class=nf>project_type_lookups</span><span class=p>(</span><span class=n>val</span><span class=p>):</span>
  <span class=n>lookup_tag</span> <span class=o>=</span> <span class=n>val</span><span class=o>.</span><span class=nb>type</span><span class=o>.</span><span class=n>tag</span>
  <span class=k>if</span> <span class=n>lookup_tag</span> <span class=o>==</span> <span class=bp>None</span><span class=p>:</span>
    <span class=k>return</span> <span class=bp>None</span>

  <span class=n>match</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>match</span><span class=p>(</span><span class=s>r"^MPEMatrix(\d)$"</span><span class=p>,</span> <span class=n>lookup_tag</span><span class=p>)</span>
  <span class=k>if</span> <span class=n>match</span><span class=p>:</span>
    <span class=k>return</span> <span class=n>MPEMatrixPrinter</span><span class=p>(</span><span class=n>val</span><span class=p>,</span> <span class=n>match</span><span class=o>.</span><span class=n>group</span><span class=p>(</span><span class=mi>1</span><span class=p>))</span>

<span class=n>gdb</span><span class=o>.</span><span class=n>pretty_printers</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>project_type_lookups</span><span class=p>)</span></code></pre></figure><p>It assumes that the matrix type has a <code class=highlighter-rouge>flat[16]</code> member field.</p><h2 id=tip-4-use-aliases><strong>Tip #4</strong>: Use aliases</h2><p>Aliases are an excellent way to speed up your day to day debugging. You specify them in your <code class=highlighter-rouge>.gdbinit</code> and look like this:</p><p><code class=highlighter-rouge>alias -a w = dashboard expression watch</code></p><h2 id=tip-5-use-automatic--variables><strong>Tip #5</strong>: Use automatic <code class=highlighter-rouge>$</code> variables</h2><p>Whenever you inspect something using the <code class=highlighter-rouge>print</code> command, gdb automatically stores the result in a variable like so:</p><figure class=highlight><pre><code class=language-gdb data-lang=gdb>&gt;&gt;&gt; print Identity
$1 = 
        [   1   0   0   0 ]
        [   0   1   0   0 ]
        [   0   0   1   0 ]
        [   0   0   0   1 ]</code></pre></figure><p>The <code class=highlighter-rouge>$1</code> is the automatic variable, and you can reference it later like so:</p><figure class=highlight><pre><code class=language-gdb data-lang=gdb>&gt;&gt;&gt; print $1
$2 = 
        [   1   0   0   0 ]
        [   0   1   0   0 ]
        [   0   0   1   0 ]
        [   0   0   0   1 ]</code></pre></figure><h2 id=tip-6-inspect-array-pointers><strong>Tip #6</strong>: Inspect array pointers</h2><p>When working with plain C-style pointer to an array you can use the following command:</p><p><code class=highlighter-rouge>&gt;&gt;&gt; print *Array@10</code></p><p>This will print 10 items from the <code class=highlighter-rouge>Array</code> pointer.</p><h2 id=tip-7-enable-command-history><strong>Tip #7</strong>: Enable command history</h2><p>Enable <a href=https://sourceware.org/gdb/onlinedocs/gdb/Command-History.html>command history</a> by adding the following to your <code class=highlighter-rouge>.gdbinit</code>:</p><p><code class=highlighter-rouge>set history save on</code></p><p>By default the history file (<code class=highlighter-rouge>.gdb_history</code>) is saved in the current directory, but if you want you can share histories by explicitly setting the output filename with <code class=highlighter-rouge>set history filename &lt;fname&gt;</code>.</p><h2 id=tip-8-detect-if-the-debugger-is-running><strong>Tip #8</strong>: Detect if the debugger is running</h2><p>This is not really a gdb specific tip, but it is useful nonetheless.</p><p>On Windows you can use the <a href="https://msdn.microsoft.com/en-us/library/windows/desktop/ms680345(v=vs.85).aspx">IsDebuggerPresent</a> function to detect if a debugger is running. You can do the same on Unix-like systems using the following function:</p><figure class=highlight><pre><code class=language-cpp data-lang=cpp>  <span class=cp>#ifndef _WIN32
</span>  <span class=cp>#include &lt;sys/ptrace.h&gt;
</span>  <span class=k>static</span> <span class=kt>int</span> <span class=nf>IsDebuggerPresent</span><span class=p>()</span>
  <span class=p>{</span>
    <span class=k>static</span> <span class=kt>int</span> <span class=n>Detected</span><span class=p>;</span>
    <span class=k>static</span> <span class=kt>int</span> <span class=n>RunningUnderDebugger</span><span class=p>;</span>
    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>Detected</span><span class=p>)</span>
    <span class=p>{</span>
      <span class=n>Detected</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
      <span class=n>RunningUnderDebugger</span> <span class=o>=</span> <span class=n>ptrace</span><span class=p>(</span><span class=n>PTRACE_TRACEME</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=k>return</span> <span class=n>RunningUnderDebugger</span><span class=p>;</span>
  <span class=p>}</span>
  <span class=cp>#endif</span></code></pre></figure><aside class="share readable"><span>Share this:</span> <a href="http://twitter.com/share?text=Tips for Productive Debugging with GDB&amp;url=https://metricpanda.com/tips-for-productive-debugging-with-gdb/index.html" class=js-analytics data-target=twitter-share onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;"><i class="icon icon-twitter"></i></a> <a href="https://www.facebook.com/sharer/sharer.php?u=https://metricpanda.com/tips-for-productive-debugging-with-gdb/index.html" class=js-analytics data-target=facebook-share onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;"><i class="icon icon-facebook"></i></a></aside></div><hr class=hr><div class="page-width newsletter-form"><form action=https://tinyletter.com/metricpanda class=js-analytics-form data-target=newsletter-submit method=post target=popupwindow onsubmit="window.open('https://tinyletter.com/metricpanda', 'popupwindow', 'scrollbars=yes,width=800,height=600');return true"><label for=tlemail><b>Metric Panda Digest</b> <em>(sent monthly and <a data-turbolinks=false class=js-analytics data-target=newsletter-preview href=/newsletters/newsletter-2016-september.html>looks like this</a>)</em></label><div class=input-group><input type=email name=email class=form-control id=tlemail placeholder="Enter your email" required> <input type=hidden value=1 name=embed> <span class=input-group-btn><button class="btn btn-primary" type=submit>Submit</button></span></div><small class=text-muted>We hate spam as much as you do!</small></form></div><hr class=hr></article></section><footer class="site-footer clearfix"><ul class="social js-social"><li><a href=https://github.com/MetricPanda class=js-analytics data-target=github-metricpanda-footer target=_blank><i class="icon icon-github-circled"></i> <b>Github</b></a></li></ul><small>&copy; 2019 Metric Panda Games All rights reserved. <i class="icon icon-star-empty" title=d32745f></i></small><div class=footer-logo><i class="icon icon-metric-panda"></i></div></footer><script data-turbolinks-track=reload data-turbolinks-eval=false type=text/javascript src=/assets/metricpanda-642bfda95fce5f4276f3ac16fa8c8ff98d1d3ef275ab201acce574d9b5d1888f.js></script></body></html>