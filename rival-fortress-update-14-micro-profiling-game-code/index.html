<!DOCTYPE html><html class=no-js><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Micro-profiling game code | Metric Panda Games</title><meta name=description content="Most game programmers like to have quick access to graphical performance charts in order to keep an eye on potential performance bottlenecks while developing or testing the game..."><meta name=keywords><meta property=og:title content="Micro-profiling game code | Metric Panda Games"><meta property=og:type content=website><meta property=og:locale content=en_US><meta property=og:url content="https://metricpanda.com/rival-fortress-update-14-micro-profiling-game-code/"><meta property=og:image content=https://metricpanda.commetric-panda-1024x1024.png><meta name=twitter:title content="Micro-profiling game code"><meta name=twitter:card content=summary_large_image><meta name=twitter:site content=@MetricPandaGame><meta name=twitter:creator content=@Unspongeful><meta name=twitter:description content="Most game programmers like to have quick access to graphical performance charts in order to keep an eye on potential performance bottlenecks while developing or testing the game..."><meta name=twitter:url content="https://metricpanda.com/rival-fortress-update-14-micro-profiling-game-code/"><meta name=twitter:url content="https://metricpanda.com/rival-fortress-update-14-micro-profiling-game-code/"><meta name=twitter:image content=https://metricpanda.commetric-panda-1024x1024.png><meta name=twitter:image:alt content="Micro-profiling game code"><link rel=canonical href="https://metricpanda.com/rival-fortress-update-14-micro-profiling-game-code/"><link rel=alternate type=application/rss+xml title="Metric Panda Games" href=https://metricpanda.com/feed.xml><link rel=apple-touch-icon href=apple-icon-precomposed.png><link rel="shortcut icon" sizes="16x16 24x24 32x32 48x48 64x64" href=https://metricpanda.com/favicon.ico><link data-turbolinks-track=reload rel=stylesheet type=text/css href=/assets/metricpanda-39b1a813586a62f5ab272a1dc423ec22fa36f235ccc08b5ec4a21a2c11cc3fe9.css></head><body><header class="header clearfix"><nav class="navbar navbar-custom js-navbar navbar-fixed-top"><div class=container><h3 class=text-muted><a href="/" class=title-backlink><span class=logo-icon><i class="logo-state sprite sprite-small-logo"></i></span><span class=logo-name>MPG</span></a></h3><ul class=nav><li class="nav-link-important nav-link"><a class=nav-action href=/rival-fortress>rival fortress</a></li><li class=nav-separator><i class="icon icon-circle"></i></li><li class=nav-link><a class=nav-action href="/">news</a></li><li class=nav-link><a class=nav-action href=/press.html>press</a></li><li class=nav-link><a data-turbolinks=false class="nav-action js-search-button search-button" href="/">&nbsp;<i class="icon icon-search"></i></a></li></ul></div></nav><section class="masthead js-masthead"><div class=masthead-home><div class=metric-panda-logo><a href="/" class="sprite sprite-logo"></a></div><h1>Metric Panda Games</h1><h2>One pixel at a time.<i></i></h2></div><div class="home-nav clearfix"><ul class="nav nav-pills"><li class=nav-item><span class="nav-block nav-title">News:</span></li><li class=nav-item><a class="nav-block nav-link" href="/">Featured</a></li><li class=nav-item><a class="nav-block nav-link" href="/news/">All</a></li><li class=nav-item><a class="nav-block nav-link" href=/news/rival-fortress.html>Rival Fortress</a></li><li class=nav-item><a class="nav-block nav-link" href=/news/other.html>Other</a></li></ul></div><div><div class="js-masthead-rainbow masthead-rainbow"><i></i></div></div></section></header><section class="js-search-results search-results"><div class="container page-content"><form class="js-search-form search-form"><div class=input-group><input type=text class="form-control js-search-query" placeholder=Search...> <span class=input-group-btn><button class="btn btn-primary" type=submit>Search</button></span></div></form><div class="js-search-results-list search-results-list posts post-list"></div><div class="js-search-results-listing js-search-result-status search-result-status search-result-listing"><button type=button class="btn btn-success js-close-search">Close <i class="icon icon-cancel-1"></i></button></div><div class="js-search-results-loading js-search-result-status search-result-status search-result-loading"><button type=button class="btn btn-info js-close-search">Loading...</button></div><div class="js-search-results-empty js-search-result-status search-result-status search-result-empty"><button type=button class="btn btn-danger js-close-search">No results found <i class="icon icon-cancel-1"></i></button></div></div></section><section class="js-main-content main-content"><article class="page-width post-page container page-content"><header class=post-header><h1 class=post-title>Micro-profiling game code</h1><p class=game-update><a href=rival-fortress>Rival Fortress Update #14</a></p><p class=post-meta>by <em>Gianni Milanesi</em> <span class=dot>•</span> Category: <a href=/news/rival-fortress.html>Rival Fortress</a></p></header><div class=post-content><p>Most game programmers like to have quick access to graphical performance charts in order to keep an eye on potential performance bottlenecks while developing or testing the game.</p><p>Every <em>off-the-shelf</em> game engine offers some kind of profiling HUD that you can enable while developing and, if you are rolling your own engine, there are many open source libraries you can quickly plug into your game (I suggest taking a look at <a href=https://twitter.com/nothings>Sean Barret</a>’s <a href="http://silverspaceship.com/src/iprof/">IProf</a> if you want something lightweight).</p><p>When you find a bottleneck the right way to optimize it is not always clear right away, and it often comes down to trial and error.</p><p>The approach I tend to use when I’m doing a performance tuning pass over the codebase is to isolate problem spots into small, self-contained, snippets of code and profile them in isolation using <em>Micro-benchmarking</em>.</p><p>Micro-benchmarking is a very useful tool for performance tuning algorithms or other self-contained code.</p><p>I find that being able to quickly iterate over the piece of code and benchmarking it against the original implementation is often eye-opening. Modern CPUs are complex beasts, and sometimes what we may think is the most optimal implementation may not actually be as fast as a maybe naive implementation.</p><h2 id=the-good-of-micro-benchmarking>The Good of micro-benchmarking</h2><p>Micro-benchmarking is perfect for exploratory-type coding.</p><p>As an example, I recently needed to tune the string hashing function used by the asset system of <a href=/rival-fortress/index.html>Rival Fortress</a>. Most string hashing is done offline, but during runtime the game has to hash strings coming in from <a href="http://www.lua.org/">Lua</a> game mods.</p><p>After trying several well known hashing algorithms, I hacked together a custom version of the <a href=https://en.wikipedia.org/wiki/MurmurHash>MurmurHash</a> that gave me a significantly better performance characteristic on the dataset used by the game.</p><h2 id=the-bad-of-micro-benchmarking>The Bad of micro-benchmarking</h2><p>Micro-benchmarking isn’t so good at giving you the big picture.</p><p>Factors that come into play when many subsystems are interacting, like cache locality and memory access, often get lost or skewed when you focus in on a small piece of code.</p><p>So it’s important to keep in the back of your mind the context in which the code you are trying to optimize will be executing.</p><h2 id=google-benchmark>Google benchmark</h2><p>My go-to library for micro-benchmarking is <a href=https://github.com/google/benchmark>Google benchmark</a>. Google benchmark is an open source library written in C++ that allows you to quickly run benchmarks over snippets of C/C++ code. Take a look at the Github repository examples.</p><p>The excellent talk at CppCon 2015 by <a href=https://twitter.com/chandlerc1024>Chandler Carruth</a> <a href="https://www.youtube.com/watch?v=nXaxk27zwlk">Tuning C++: Benchmarks, and CPUs, and Compilers!</a> goes into some detail on how to use Google benchmark understand profiler output and how to use <a href=https://perf.wiki.kernel.org/index.php/Main_Page>perf</a> on Linux to dig deeper into optimized C++ executables.</p><aside class="share readable"><span>Share this:</span> <a href="http://twitter.com/share?text=Rival Fortress Update #14: Micro-profiling game code&amp;url=https://metricpanda.com/rival-fortress-update-14-micro-profiling-game-code/index.html" class=js-analytics data-target=twitter-share onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;"><i class="icon icon-twitter"></i></a> <a href="https://www.facebook.com/sharer/sharer.php?u=https://metricpanda.com/rival-fortress-update-14-micro-profiling-game-code/index.html" class=js-analytics data-target=facebook-share onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;"><i class="icon icon-facebook"></i></a></aside></div><hr class=hr><div class="page-width newsletter-form"><form action=https://tinyletter.com/metricpanda class=js-analytics-form data-target=newsletter-submit method=post target=popupwindow onsubmit="window.open('https://tinyletter.com/metricpanda', 'popupwindow', 'scrollbars=yes,width=800,height=600');return true"><label for=tlemail><b>Metric Panda Digest</b> <em>(sent monthly and <a data-turbolinks=false class=js-analytics data-target=newsletter-preview href=/newsletters/newsletter-2016-september.html>looks like this</a>)</em></label><div class=input-group><input type=email name=email class=form-control id=tlemail placeholder="Enter your email" required> <input type=hidden value=1 name=embed> <span class=input-group-btn><button class="btn btn-primary" type=submit>Submit</button></span></div><small class=text-muted>We hate spam as much as you do!</small></form></div><hr class=hr></article></section><footer class="site-footer clearfix"><ul class="social js-social"><li><a href=https://github.com/MetricPanda class=js-analytics data-target=github-metricpanda-footer target=_blank><i class="icon icon-github-circled"></i> <b>Github</b></a></li></ul><small>&copy; 2019 Metric Panda Games All rights reserved. <i class="icon icon-star-empty" title=d32745f></i></small><div class=footer-logo><i class="icon icon-metric-panda"></i></div></footer><script data-turbolinks-track=reload data-turbolinks-eval=false type=text/javascript src=/assets/metricpanda-642bfda95fce5f4276f3ac16fa8c8ff98d1d3ef275ab201acce574d9b5d1888f.js></script></body></html>