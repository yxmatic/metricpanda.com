<!DOCTYPE html><html class=no-js><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Minimal Perfect Hashing for Game Assets | Metric Panda Games</title><meta name=description content="Perfect hash functions are the holy grail of hashing functions.They guarantee no key collisions and work really well when dealing with data that is either static, where all keys..."><meta name=keywords><meta property=og:title content="Minimal Perfect Hashing for Game Assets | Metric Panda Games"><meta property=og:type content=website><meta property=og:locale content=en_US><meta property=og:url content="https://metricpanda.com/rival-fortress-update-24-minimal-perfect-hash-for-game-assets/"><meta property=og:image content=https://metricpanda.commetric-panda-1024x1024.png><meta name=twitter:title content="Minimal Perfect Hashing for Game Assets"><meta name=twitter:card content=summary_large_image><meta name=twitter:site content=@MetricPandaGame><meta name=twitter:creator content=@Unspongeful><meta name=twitter:description content="Perfect hash functions are the holy grail of hashing functions.They guarantee no key collisions and work really well when dealing with data that is either static, where all keys..."><meta name=twitter:url content="https://metricpanda.com/rival-fortress-update-24-minimal-perfect-hash-for-game-assets/"><meta name=twitter:url content="https://metricpanda.com/rival-fortress-update-24-minimal-perfect-hash-for-game-assets/"><meta name=twitter:image content=https://metricpanda.commetric-panda-1024x1024.png><meta name=twitter:image:alt content="Minimal Perfect Hashing for Game Assets"><link rel=canonical href="https://metricpanda.com/rival-fortress-update-24-minimal-perfect-hash-for-game-assets/"><link rel=alternate type=application/rss+xml title="Metric Panda Games" href=https://metricpanda.com/feed.xml><link rel=apple-touch-icon href=apple-icon-precomposed.png><link rel="shortcut icon" sizes="16x16 24x24 32x32 48x48 64x64" href=https://metricpanda.com/favicon.ico><link data-turbolinks-track=reload rel=stylesheet type=text/css href=/assets/metricpanda-39b1a813586a62f5ab272a1dc423ec22fa36f235ccc08b5ec4a21a2c11cc3fe9.css></head><body><header class="header clearfix"><nav class="navbar navbar-custom js-navbar navbar-fixed-top"><div class=container><h3 class=text-muted><a href="/" class=title-backlink><span class=logo-icon><i class="logo-state sprite sprite-small-logo"></i></span><span class=logo-name>MPG</span></a></h3><ul class=nav><li class="nav-link-important nav-link"><a class=nav-action href=/rival-fortress>rival fortress</a></li><li class=nav-separator><i class="icon icon-circle"></i></li><li class=nav-link><a class=nav-action href="/">news</a></li><li class=nav-link><a class=nav-action href=/press.html>press</a></li><li class=nav-link><a data-turbolinks=false class="nav-action js-search-button search-button" href="/">&nbsp;<i class="icon icon-search"></i></a></li></ul></div></nav><section class="masthead js-masthead"><div class=masthead-home><div class=metric-panda-logo><a href="/" class="sprite sprite-logo"></a></div><h1>Metric Panda Games</h1><h2>One pixel at a time.<i></i></h2></div><div class="home-nav clearfix"><ul class="nav nav-pills"><li class=nav-item><span class="nav-block nav-title">News:</span></li><li class=nav-item><a class="nav-block nav-link" href="/">Featured</a></li><li class=nav-item><a class="nav-block nav-link" href="/news/">All</a></li><li class=nav-item><a class="nav-block nav-link" href=/news/rival-fortress.html>Rival Fortress</a></li><li class=nav-item><a class="nav-block nav-link" href=/news/other.html>Other</a></li></ul></div><div><div class="js-masthead-rainbow masthead-rainbow"><i></i></div></div></section></header><section class="js-search-results search-results"><div class="container page-content"><form class="js-search-form search-form"><div class=input-group><input type=text class="form-control js-search-query" placeholder=Search...> <span class=input-group-btn><button class="btn btn-primary" type=submit>Search</button></span></div></form><div class="js-search-results-list search-results-list posts post-list"></div><div class="js-search-results-listing js-search-result-status search-result-status search-result-listing"><button type=button class="btn btn-success js-close-search">Close <i class="icon icon-cancel-1"></i></button></div><div class="js-search-results-loading js-search-result-status search-result-status search-result-loading"><button type=button class="btn btn-info js-close-search">Loading...</button></div><div class="js-search-results-empty js-search-result-status search-result-status search-result-empty"><button type=button class="btn btn-danger js-close-search">No results found <i class="icon icon-cancel-1"></i></button></div></div></section><section class="js-main-content main-content"><article class="page-width post-page container page-content"><header class=post-header><h1 class=post-title>Minimal Perfect Hashing for Game Assets</h1><p class=game-update><a href=rival-fortress>Rival Fortress Update #24</a></p><p class=post-meta>by <em>Gianni Milanesi</em> <span class=dot>•</span> Category: <a href=/news/rival-fortress.html>Rival Fortress</a></p></header><div class=post-content><p><a href=https://en.wikipedia.org/wiki/Perfect_hash_function>Perfect hash functions</a> are the holy grail of hashing functions. They guarantee no key collisions and work really well when dealing with data that is either static, where all keys are known in advance, or rarely changing.</p><p><a href=https://en.wikipedia.org/wiki/Perfect_hash_function#Minimal_perfect_hash_function>Minimal perfect hash functions</a> (MPHF) are even better. They guarantee 100% load factor, so your hash tables will contain only one entry for each key, and no empty slots.</p><p>Hash tables that use MPHF are more memory efficient and have generally faster retrieval times; they also have excellent cache locality by removing cache misses that arise due to <a href=https://en.wikipedia.org/wiki/Hash_table#Collision_resolution>collision resolution</a> schemes required for traditional hash tables.</p><p>The downside is that MPHF-backed hash tables are more costly to generate and trickier to implement, as they require more setup than most hash table implementations. This makes them impractical for dynamic data set like the ones you usually find in games.</p><h2 id=mphf-for-game-asset-lookups>MPHF for game asset lookups</h2><p>For the asset system used by <a href=/rival-fortress/index.html>Rival Fortress</a> I decided to use MPHF-backed hash tables for asset and font kerning lookups.</p><p>The reason for adding hash table lookups to assets, instead of just indexing them statically, is because of the engine’s modding capabilities. Users will be able to add custom assets and refer to them through <code class=highlighter-rouge>LUA</code>, so internally they have to be stored in hash tables.</p><p>Fortunately, both engine and mod assets are preprocessed offline, so I can leverage MPHF without having to pay the runtime cost.</p><p>Assets are referenced through an unsigned 32-bit integer generated by the preprocessor. The key is used to calculate the <em>intermediate</em> MPHF lookup table and this, in turn, is used to populate the final assets hash table that is then stored in the <code class=highlighter-rouge>PAK</code> file.</p><p>The hash tables, generated using an implementation based on the <a href=http://cmph.sourceforge.net/papers/esa09.pdf>Compress, Hash, and Displace</a> algorithm. I’m using a load factor of 100%, and <code class=highlighter-rouge>lambda</code> values of 1 and 4 for assets and for font kerning data.</p><h2 id=additional-resources>Additional resources</h2><p>I won’t share any example code as my implementation is tightly coupled with the asset preprocessor, but I’ll point you in the direction of some open source implementations:</p><ul><li>(LGPL/MPL) <a href="http://cmph.sourceforge.net/">http://cmph.sourceforge.net/</a></li><li>(GPL) <a href=http://www.gnu.org/software/gperf>http://www.gnu.org/software/gperf</a></li><li>(Public domain) <a href=http://burtleburtle.net/bob/hash/perfect.html>http://burtleburtle.net/bob/hash/perfect.html</a></li><li>(MIT) <a href=https://github.com/wahern/phf>https://github.com/wahern/phf</a></li></ul><aside class="share readable"><span>Share this:</span> <a href="http://twitter.com/share?text=Rival Fortress Update #24: Minimal Perfect Hashing for Game Assets&amp;url=https://metricpanda.com/rival-fortress-update-24-minimal-perfect-hash-for-game-assets/index.html" class=js-analytics data-target=twitter-share onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;"><i class="icon icon-twitter"></i></a> <a href="https://www.facebook.com/sharer/sharer.php?u=https://metricpanda.com/rival-fortress-update-24-minimal-perfect-hash-for-game-assets/index.html" class=js-analytics data-target=facebook-share onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;"><i class="icon icon-facebook"></i></a></aside></div><hr class=hr><div class="page-width newsletter-form"><form action=https://tinyletter.com/metricpanda class=js-analytics-form data-target=newsletter-submit method=post target=popupwindow onsubmit="window.open('https://tinyletter.com/metricpanda', 'popupwindow', 'scrollbars=yes,width=800,height=600');return true"><label for=tlemail><b>Metric Panda Digest</b> <em>(sent monthly and <a data-turbolinks=false class=js-analytics data-target=newsletter-preview href=/newsletters/newsletter-2016-september.html>looks like this</a>)</em></label><div class=input-group><input type=email name=email class=form-control id=tlemail placeholder="Enter your email" required> <input type=hidden value=1 name=embed> <span class=input-group-btn><button class="btn btn-primary" type=submit>Submit</button></span></div><small class=text-muted>We hate spam as much as you do!</small></form></div><hr class=hr></article></section><footer class="site-footer clearfix"><ul class="social js-social"><li><a href=https://github.com/MetricPanda class=js-analytics data-target=github-metricpanda-footer target=_blank><i class="icon icon-github-circled"></i> <b>Github</b></a></li></ul><small>&copy; 2019 Metric Panda Games All rights reserved. <i class="icon icon-star-empty" title=d32745f></i></small><div class=footer-logo><i class="icon icon-metric-panda"></i></div></footer><script data-turbolinks-track=reload data-turbolinks-eval=false type=text/javascript src=/assets/metricpanda-642bfda95fce5f4276f3ac16fa8c8ff98d1d3ef275ab201acce574d9b5d1888f.js></script></body></html>